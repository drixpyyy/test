<!DOCTYPE html>
<html>
<head>
    <title>Roblox Screen Relay</title>
    <style>
        body { background: #111; color: white; font-family: sans-serif; text-align: center; }
        canvas { border: 2px solid #444; margin-top: 10px; background: #000; width: 400px; }
        .status { color: #0f0; font-weight: bold; }
    </style>
</head>
<body>
    <h2>Roblox Screen Capture</h2>
    <p>1. Click Start and select the <b>Roblox Window</b></p>
    <button onclick="startCapture()" style="padding:10px 20px; cursor:pointer;">Start Capture</button>
    <p id="status">Status: Waiting...</p>
    <canvas id="prev"></canvas>

    <script>
        const canvas = document.getElementById('prev');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        let video = document.createElement('video');

        async function startCapture() {
            try {
                const stream = await navigator.mediaDevices.getDisplayMedia({
                    video: { displaySurface: "window" }
                });
                video.srcObject = stream;
                video.play();
                document.getElementById('status').innerText = "Status: CAPTURING (Running)";
                setInterval(updateData, 100); // Send frame data every 100ms
            } catch (err) { alert("Error: " + err); }
        }

        function updateData() {
            // We use a small resolution so Roblox doesn't explode
            const w = 40; // 320p scale
            const h = 22;
            canvas.width = w; canvas.height = h;
            ctx.drawImage(video, 0, 0, w, h);
            
            const pixels = ctx.getImageData(0, 0, w, h).data;
            let frame = [];
            for (let y = 0; y < h; y++) {
                let row = [];
                for (let x = 0; x < w; x++) {
                    const i = (y * w + x) * 4;
                    row.push([pixels[i], pixels[i+1], pixels[i+2]]);
                }
                frame.push(row);
            }
            // This is where you'd host the JSON. 
            // For now, it logs to console. To make it work with GitHub, 
            // you'd need a GitHub Token to auto-update a file (highly complex).
            console.log(JSON.stringify(frame)); 
        }
    </script>
</body>
</html>
